<!DOCTYPE html>
<!--
 Licensed to the Apache Software Foundation (ASF) under one
 or more contributor license agreements.  See the NOTICE file
 distributed with this work for additional information
 regarding copyright ownership.  The ASF licenses this file
 to you under the Apache License, Version 2.0 (the
 "License"); you may not use this file except in compliance
 with the License.  You may obtain a copy of the License at
 
 http://www.apache.org/licenses/LICENSE-2.0
 
 Unless required by applicable law or agreed to in writing,
 software distributed under the License is distributed on an
 "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
 KIND, either express or implied.  See the License for the
 specific language governing permissions and limitations
 under the License.
 -->
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="format-detection" content="telephone=no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="initial-scale=1, maximum-scale=1, width=device-width" />
        <title>Glory Makeup</title>
        <!-- Latest compiled and minified CSS -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

        <!-- Optional theme -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap-theme.min.css">
        <!-- Glyphicon Animate Css-->
        <link rel="stylesheet" href="css/glyphicon-animate.css">
        <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
        <script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
        <script src="http://code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
        <!-- Latest compiled and minified JavaScript -->
        <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
        <script defer src="js/jcanvas.min.js"></script>
        
        <style type="text/css">
        .socket-data, .sho-pic, .steps, .steps-back{
            display:none;
        }
        .steps{
            padding-top:25%;
        }
        .sho-pic-container{
            width:320px;
            height:360px;
            margin: 0 auto;
            overflow: hidden;
            position: absolute;
            display:none;
        }
        .lmp{
            position:absolute;
            width:2px;
            height:2px;
            background:#666;
        }
        .lmp.bigp{
            width:3px;
            height:3px;
            background:#f00;
        }
        .pag-camera{ /*.pag-index*/
            display:none;
        }
        .pag{
            width:100vw;
            height:100vh;
            position:absolute;
            background:#000;
        }
        .bckcvr{
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }
        .pag-header{
            background: url(img/background-Top.png) repeat-y center center;
            padding:5px;
        }
        .pag-footer{
            width:100%;
            min-height:150px;
            position:relative;
            text-align: center;
        }
        .pag-index .pag-footer{
            background: url(img/background-down.png) no-repeat center top;
            padding-top: 30px;
        }
        .pag-content{
            position:relative;
        }
        .logo{
            width:25%;
            margin:5px auto;
        }
        .logo img, .pag-content img{
            width:100%;
        }
        .gear-bt{
            position: absolute;
            top:25px;
            left:25px;
            color:#fff;
            font-size: 1.5em;
        }
        .sbt{
            display:block;
            width:70%;
            margin:10px auto;
            border:#fff solid 1px;
            text-align: center;
            padding:10px 0;
            color:#fff;
            cursor:pointer;
        }
        .sbt.inline{
            display: inline-block;
            width: auto;
            padding: 5px 10px;
            margin: 15px 6px;
        }
        a.sbt:link, a.sbt:visited, a.sbt:hover, a.sbt:focus, a.sbt:active{
            color:#fff;
            text-decoration: none;
        }
        .modal-content{
            background: #000;
            color:#fff;
        }
        .modal-content .close{
            color:#fff;
        }
        .photo-container{
            padding:45px 0 0 0;
            text-align: center;
            position: relative;
        }
        .photo-deco{
            max-width:80%;
            margin:auto;
        }
        .photo-deco img{
            max-width:100%;
        }
        .pag-funcs-content{
            position:absolute;
            top:0;
            width:100%;
            padding: 10px;
        }
        .pag-funcs{
            width:7.5vw;
            height:7.5vw;
        }
        .list-btn{
            background: url(img/function-button.png) no-repeat;
            background-size: 100% 100%;
        }
        .del-btn{
            background: url(img/Delete-button.png) no-repeat;
            background-size: 100% 100%;
        }
        .photo-msg{
            position:absolute;
            width:60vw;
            top:45%;
            left:20vw;
            height:60px;
            margin-top:-30px;
        }
        .photo-msg-loader{
            font-size: 2em;
        }
        #pic-canvas{
            position: absolute;
            top:70px;
            left:0;
        }
        .style-choice-txt{
            padding:25px 0;
            color: #fff;
        }
        .style-share a{
            display:inline-block;
            margin:0 10px;
        }
        .style-footer{
            position:absolute; top:200px; left:0; width:100%;
        }
        .inks{
            width:96%;
            margin:auto;
            color:#fff;
            padding-bottom:20px;
        }
        .ink-color{
            width:80px;
            height:80px;
            border-radius:40px;
            position: relative;
        }
        .ink-color .err-color{
            width:60px;
            height:60px;
            border-radius:30px;
            position:absolute;
            left:10px;
            top:10px;
            padding-top:20px;
            color:#000;
            text-align:center;
            box-shadow: 0 0 8px black;
        }
        #slidemenu {
            background: #333;
            left: -100%;
            width: 80%;
            min-width: 0;
            position: absolute;
            padding-left: 0;
            z-index: 2;
            top: 0px;
            margin: 0;
        }
        #slidemenu .navbar-nav {
            min-width: 0;
            width: 100%;
            margin: 0;
        }
        #slidemenu .navbar-nav .dropdown-menu li a {
            min-width: 0;
            width: 80%;
            white-space: normal;
        }
        #slide-nav {
            border-top: 0
        }
        #navbar-height-col {
            position: fixed;
            top: 0;
            height: 100%;
            bottom:0;
            width: 80vw;
            left: -80%;
            background: #333;
        }
        </style>
    </head>
    <body style="background:#000;">
        <div class="pag pag-index">
            <div class="pag-header">
                <div class="logo">
                    <img src="img/background-Top-Logo.png" />
                </div>
            </div>
            <div class="pag-content">
                <img src="img/Videobutten.png" />
            </div>
            <div class="pag-content">
                <img src="img/Content_Preferences_butten.png" />
                <a class="gear-bt" data-toggle="modal" data-target="#config-modal"><span class="glyphicon glyphicon-cog" aria-hidden="true"></span></a>
            </div>
            <div class="pag-footer bckcvr">
                <a id="start-btn" class="sbt" onclick="show_page('.pag-camera');" disabled="disabled">開始化妝</a>
            </div>
        </div>
        <div class="pag pag-camera">
            <div class="photo-container">
                <div class="photo-deco">
                    <img src="img/Camera_range.png" />
                </div>
                <div class="photo-msg">
                    <div class="photo-msg-loader"><i class="glyphicon glyphicon-refresh gly-spin"></i></div>
                    <div id="photo-msg-text"></div>
                </div>
                <canvas id="pic-canvas" width="320" height="360"></canvas>
            </div>
            <div class="pag-footer bckcvr">
                <a id="camera-btn1" onclick="retake_pic();" class="sbt">重新拍攝</a>
                <a id="camera-btn2" class="sbt" style="display:none" onclick="show_page('.pag-picture')">下一步</a>
            </div>
            <div class="pag-funcs-content">
            <a class="pag-funcs pull-left list-btn" ></a>
            <a class="pag-funcs pull-right del-btn" onclick="show_page('.pag-index')" ></a>
            <div class="clearfix"></div>
            </div>
        </div>
        <div class="pag pag-picture">
            <div class="photo-container">
                <div class="sho-pic-container"></div>
                <canvas id="photo-canvas" width="320" height="360"></canvas>
            </div>
            <div class="pag-footer">
                <div class="row style-choices" style="display:none; width: 90%; margin: -20px auto 0 auto;">
                    <div class="col-xs-4 text-center" onclick="draw_face('1');">
                        <img src="img/orange-button.png" />
                        <div class="style-choice-txt text-center">都會知性</div>
                    </div>
                    <div class="col-xs-4 text-center" onclick="draw_face('2');">
                        <img src="img/pink-button.png" />
                        <div class="style-choice-txt text-center">氣質甜美</div>
                    </div>
                    <div class="col-xs-4 text-center" onclick="draw_face('3');">
                        <img src="img/green-button.png" />
                        <div class="style-choice-txt text-center">時尚名媛</div>
                    </div>
                </div>
                <div class="row style-simulate " style="display:none;" >
                    <div class="text-center" style="margin-top:15px">
                        <a class="sbt inline" onclick="reset_style()">重選妝容</a>
                        <a class="sbt inline" onclick="share_style()">分享妝容</a>
                        <a class="sbt inline" onclick="show_page('.pag-chk-inks');">開始化妝</a>
                    </div>
                </div>
                <div class="row style-share " style="display:none;">
                    <div class="text-center" style="margin-top:15px">
                    <a onclick="share_social('1');"><img src="images/share/fb-button.png" /></a>
                    <a onclick="share_social('2');"><img src="images/share/line-button.png" /></a>
                    <a onclick="share_social('3');"><img src="images/share/wechat-button.png" /></a>
                    </div>
                    <div class="text-center" style="margin-top:15px;" >
                        <a class="sbt" onclick="return_style()">返回</a>
                    </div>
                </div>
            </div>
            <div class="pag-funcs-content">
            <a class="pag-funcs pull-left list-btn" ></a>
            <a class="pag-funcs pull-right del-btn" onclick="show_page('.pag-index')" ></a>
            <div class="clearfix"></div>
            </div>
        </div>
        <div class="pag pag-chk-inks">
            <div class="pag-content">
                <div class="row inks" style="padding-top:70px;">
                    <div class="col-xs-4 text-center">
                        <div class="ink-color" style="background:#f4dbaa;"></div>
                        <div class="ink-txt text-center">粉底 #155</div>
                    </div>
                    <div class="col-xs-4 text-center">
                        <div class="ink-color" style="background:#fadfaf;">
                            <div class="err-color" style="background:#ffd691;">#1345</div>
                        </div>
                        <div class="ink-txt text-center">打亮 #155H</div>
                    </div>
                    <div class="col-xs-4 text-center">
                        <div class="ink-color" style="background:#f2c68c;"></div>
                        <div class="ink-txt text-center">修容 #156</div>
                    </div>
                </div>
                <div class="row inks">
                    <div class="col-xs-4 text-center">
                        <div class="ink-color" style="background:#f9bfc1;"></div>
                        <div class="ink-txt text-center">眼影a #182</div>
                    </div>
                    <div class="col-xs-4 text-center">
                        <div class="ink-color" style="background:#e29ed6;"></div>
                        <div class="ink-txt text-center">眼影b #251</div>
                    </div>
                    <div class="col-xs-4 text-center">
                        <div class="ink-color" style="background:#753802;"></div>
                        <div class="ink-txt text-center">眼影c #725</div>
                    </div>
                </div>
                <div class="row inks">
                    <div class="col-xs-4 text-center">
                        <div class="ink-color" style="background:#f9afd3;"></div>
                        <div class="ink-txt text-center">腮紅a #236</div>
                    </div>
                    <div class="col-xs-4 text-center">
                        <div class="ink-color" style="background:#f9baaa;"></div>
                        <div class="ink-txt text-center">腮紅b #169</div>
                    </div>
                    <div class="col-xs-4 text-center">
                    </div>
                </div>
            </div>
            <div class="pag-footer bckcvr">
                <a class="sbt inline" onclick="show_page('.pag-picture')">返回</a>
                <a class="sbt inline" onclick="correct_ink()" id="btn-start-makeup" >重新整理</a>
            </div>
            <div class="pag-funcs-content">
            <a class="pag-funcs pull-left list-btn" ></a>
            <a class="pag-funcs pull-right del-btn" onclick="show_page('.pag-index')" ></a>
            <div class="clearfix"></div>
            </div>
        </div>
        <div class="pag pag-makeup">
            <div class="pag-content" style="height:75vh">
                <div class="steps-msg" style="padding: 250px 0 0 0; text-align: center; color: #fff;">正在連結化妝機，請稍候。。。</div>
            </div>
            <div class="pag-footer bckcvr">
                <a class="sbt" onclick="show_page('.pag-index')">返回</a>
            </div>
            <div class="pag-funcs-content">
            <a class="pag-funcs pull-left list-btn" ></a>
            <a class="pag-funcs pull-right del-btn" onclick="show_page('.pag-index')" ></a>
            <div class="clearfix"></div>
            </div>
        </div>
        <div id="config-modal" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </button>
                    <h4 class="modal-title">Settings</h4>
                  </div>
                  <div class="modal-body">
                    <form name="settings-form" role="form">
                    <div class="form-group">
                    <label for="server_ip">Server IP</label>
                    <input class="form-control" name="server_ip" id="server_ip" value="localhost" placeholder="請輸入Server IP" />
                    </div>
                    <div class="form-group">
                    <label for="server_port">Server Port</label>
                    <input class="form-control" name="server_port" id="server_port" value="3000" placeholder="請輸入Port" />
                    </div>
                    </form>
                  </div>
                  <div class="modal-footer">
                        <a class="btn btn-primary btn-block" id="but1" onclick="connectServer();">連接Server</a>
                  </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <div id="alert-modal" class="modal">
            <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    </button>
                    <h4 class="modal-title" id="alert-title"></h4>
                  </div>
                  <div class="modal-body">
                    <div id="alert-content"></div>
                  </div>
                  <div class="modal-footer">
                        <a class="btn btn-primary" id="btn-close-alert"  data-dismiss="modal" >確定</a>
                  </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
        <div id="slidemenu">
            <ul class="nav navbar-nav">
                <li class="active"><a href="#">Settings</a></li>
                <li><a href="#about">About</a></li>
                <li><a href="#contact">Contact</a></li>
                <li><a id="togglePoints">Show</a></li>
            </ul>
        </div>
        <div class="inverse" id="navbar-height-col"></div>
        <!--<script type="text/javascript" src="cordova.js"></script>-->
        <script type="text/javascript">
            
            var host = "localhost",
            port = "3000",
            data = "-- data to be sent --",
            key = "",
            proc = "",
            stat = "",
            pic_load="N",
            pic_file="face_w.bmp";
            var socket = io();
            var mask_w = 230;
            var mask_h = 320;
            var screen_w = 320;
            var center_x = 160;
            var center_y = 180;
            var screen_w = 360;
            var locations = {};
            var def_face = "images/camera/demoface.jpg";
            var msg1="系統正在讀取您前次的拍攝記錄，請稍候。";
            var msg2="請將您的頭臉按照說明書指示，就正確的位置後，系統會自動進行拍照";
            var msg3="系統無法讀取您前次拍攝記錄，請重新拍攝。";
            $(function(){
                socket.on('cmd', function(msg){
                    data_receiver(msg);    
                });
                screen_w = $(window).width();
                center_x = parseInt(screen_w/2);
                show_page('.pag-index');
            });
            function show_page(target_page){
                $('.pag').hide();
                $('.modal').modal('hide'); 
                $(target_page).show();
                init_page(target_page);
            }
            function init_page(target_page){
                host = $('#server_ip').val();
                def_face = 'http://' + host + '/'+pic_file+'?r='+get_random_str();
                if(target_page == '.pag-camera'){
                    pic_load = "N";    
                    center_y = parseInt($('.photo-deco').height() / 2);
                    $('#photo-msg-text').html(msg1);
                    $('.photo-msg-loader').css('opacity',1);
                    $('#pic-canvas').clearCanvas().drawEllipse({
                      x: center_x, 
                      y: center_y -25,
                      width: mask_w, 
                      height: mask_h,
                      mask:true
                    }).drawImage({
                      source: def_face,
                      x: center_x, y: center_y,
                      scale: 1,
                      load: pic_canvas_img_load
                    });
                    setTimeout(handle_no_pic, 6000);
                }else if(target_page == '.pag-picture'){
                    center_x = 160;
                    center_y = 180;
                    $('#photo-canvas').clearCanvas().drawImage({
                      source: def_face,
                      x: center_x, y: center_y,
                      scale: 1,
                      load: photo_canvas_img_load
                    });
                }else if(target_page == '.pag-chk-inks'){
                    if($('.err-color:visible').length > 0){
                        msgbox_show('色匣不符合','您所設置的色匣不符合本妝感的色匣配置，請您參考畫面上的提示更換正確的色匣後，按「重新整理」再試一次。');
                    }
                }
            }
            function pic_canvas_img_load() {
                if(pic_load == "X"){
                    $('#photo-msg-text').html("");
                }
                pic_load = "Y";
                get_landmark_locations();
                $('.photo-msg-loader').css('opacity',0);
                $('#camera-btn1').html('重新拍攝').show();
                $('#camera-btn2').show();
            }
            function photo_canvas_img_load(){
                $('.style-choices').fadeIn();
            }
            function draw_face(snum){
                //var cur_host = 'http://' + host + '/images/simulate/';
                var cur_host = 'img/';
                brush_left = cur_host+ 'brush_left'+snum+'.png?r='+get_random_str();
                brush_right = cur_host+ 'brush_right'+snum+'.png?r='+get_random_str();
                eye_left = cur_host+ 'eye_left'+snum+'.png?r='+get_random_str();
                eye_right = cur_host+ 'eye_right'+snum+'.png?r='+get_random_str();
                var loc = get_draw_locs();
                $('#photo-canvas').drawImage({
                    source: brush_left,
                    x: loc.blx, y: loc.bly,
                    scale: 0.7,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'brushleft'
                }).drawImage({
                    source: brush_right,
                    x: loc.brx, y: loc.bry,
                    scale: 0.7,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'brushright'
                }).drawImage({
                    source: eye_left,
                    x: loc.elx, y: loc.ely,
                    scale: 0.8,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'eyeleft'
                }).drawImage({
                    source: eye_right,
                    x: loc.erx, y: loc.ery,
                    scale: 0.8,
                    layer: true,
                    fromCenter: true,
                    groups: ['makeups'],
                    name: 'eyeright'
                });
                $('.style-choices').fadeOut( function(){
                    $('.style-simulate').fadeIn();
                });
            }
            function return_style(){
                $('.style-simulate, .style-share').hide();
                $('.style-choices').fadeIn();
            }
            function reset_style(){
                init_page('.pag-picture');
                $('.style-simulate, .style-share').fadeOut(function(){
                    $('.style-choices').fadeIn();
                });
            }
            function share_style(){
                $('.style-simulate').fadeOut( function(){
                    $('.style-share').fadeIn();
                });
            }
            function correct_ink(){
                if($('.err-color').length > 0){
                    $('.err-color').remove(); 
                    $('#btn-start-makeup').html('開始化妝'); 
                }else{
                    start_makeup();
                }
            }
            function start_makeup(){
                reset_style();
                show_page('.pag-makeup');
            }
            function share_social(){

            }
            function handle_no_pic(){
                if(pic_load == "N"){
                    piv_load = "X";
                    $('#photo-msg-text').html(msg3);
                    $('#camera-btn1').html('拍攝照片').show();
                    $('#camera-btn2').hide();
                    $('.photo-msg-loader').css('opacity',0);
                }
            }
            function connectServer(){
                if(stat == ""){
                    host = $('#server_ip').val();
                    port = $('#server_port').val();
                    if(host.length > 0 && port.length > 0){
                        stat = "connecting";
                        connect();
                    }else{
                        alert('請輸入Server IP');
                    }
                }else if(stat == "connected"){
                    stat = "disconnecting";
                    disconnect();
                }
            }
            function stub(d) {
                alert("debug:"+ d);
            }
            function onConnect(k) {
                alert('Connection established with ' + k);
                key = k;
                isConnected(k, function(){
                   $('#but').html('中斷連結').removeClass('btn-primary').addClass('btn-danger');
                    $('.server-info').slideUp();
                    $('.socket-data').show();
                    stat = "connected";
                    $('') 
                }, function(){
                    alert('Socket Server Connection Failed!');
                });
            }

            //send (successCallback, errorCallback, connectionId, data)
            function send(str) {
                
            }
            
            function disconnect() {
                
                stat = "";
                $('.server-info').slideDown();
                $('.socket-data').hide();
                $('.steps').hide();
                $('#but').html('連接Server').removeClass('btn-danger').addClass('btn-primary');
            }
            function disconnectAll() {
                window.tlantic.plugins.socket.disconnectAll(stub, stub);
            }
            function isConnected(k, funsucc, funerr) {
                if(!k) k = key;
                if(typeof(funsucc) != 'function') funsucc = stub;
                if(typeof(funerr) != 'function') funerr = stub;
                window.tlantic.plugins.socket.isConnected(k, funsucc, funerr);
            }
            function retake_pic(){
                if(pic_file == 'face.bmp'){
                    pic_file = 'face2.bmp';
                }else if(pic_file == 'face2.bmp'){
                    pic_file = 'face3.bmp';
                }else{
                    pic_file = 'face.bmp';
                }
                show_page('.pag-camera');
            }
            function startProc(cmd){
                if(cmd == 'get_pic'){
                    proc = "wait for pic";
                    $('#sho-pic-img').attr('src','');
                    send("get_pic");
                }else if(cmd == 'select_type'){
                    proc = "wait for makeup";
                    send("select_type=1");
                }
            }
            function handelProc(rcv){
                if(rcv == 'get_pic_ok'){
                    //讀取圖片
                    $('#sho-pic-img').attr('src', 'http://' + host + '/face.bmp?r='+get_random_str());
                    $('.socket-data').hide();
                    $('.sho-pic').show();
                    get_landmark_locations();
                    return;
                }
                var f = rcv.substring(1);
                if(f == 'step1'){
                    //切換到步驟1
                    $('.sho-pic').hide();
                    $('.steps').show();
                    $('.steps-msg').html('步驟 1 &gt;&gt;&gt;');
                }
                if(f == 'step2'){
                    $('.steps').show();
                    $('.steps-msg').html('步驟 2 &gt;&gt;&gt;');
                }
                if(f == 'step3'){
                    $('.steps').show();
                    $('.steps-msg').html('步驟 3 &gt;&gt;&gt;');
                }
                if(f == 'makeup_complete'){
                    $('.steps').show();
                    $('.steps-msg').html('步驟完成');
                    $('.steps-back').show();
                }
            }
            function backToStart(){
                $('.socket-data').show();
                $('.sho-pic, .steps').hide();
            }
            function get_random_str(){
                var s = Math.floor((Math.random() * 10000) + 1);
                return s.toString();
            }
            function get_landmark_locations(){
                var s = '';
                var fpath = 'http://' + host + '/2d_landmarks.txt?r='+get_random_str();
                get_text(fpath, {}, function(res){
                    try{
                        var lines = res.split("\n");
                        var numLines = lines.length;
                        var i;
                        var n = 0;
                        // parse phrases
                        for (i = 2; i < numLines; i++) {
                          var line = lines[i];
                          if (line.length <= 0) {
                            continue;
                          } else {
                            //拆解這行變成X,Y兩個值
                            var points = line.split(" ");
                            var px = parseInt(points[0]);
                            var py = parseInt(points[1]);
                            var point =  {'x':px, 'y':py};
                            console.log(px+','+py);
                            point= fix_locations(point);
                            n++;
                            locations['p' + n] =point;
                          }
                        }
                        try{
                            draw_landmarks();
                        }catch(e){
                            alert('error test draw!!');
                            console.log(e);
                        }
                    }catch(e){
                        alert('error happend!! res=' + res);
                        console.log(e);
                    }
                });
            }
            function draw_landmarks(){
                var targetarray = ['p54','p31','p60', 'p70','p33','p64','p12','p14','p77','p71','p20','p22','p78','p74'];
                var cls, ctxt;
                $.each(locations, function(k, v){
                    cls = '';
                    ctxt = '';
                    if(targetarray.indexOf(k) >= 0){
                        cls = 'bigp';
                        ctxt = k;
                    }
                    draw_point(k, v, cls, ctxt);
                });
            }
            function draw_point(k, v, cls, ctxt){
                var p = '<div class="lmp '+cls+'" id="'+k+'">'+ctxt+'</div>';
                var pobj = $(p);
                pobj.appendTo('.sho-pic-container').css({'position':'absolute', 'top':v.y+'px', 'left':v.x+'px'});
            }
            function get_draw_locs(){
                var pla = locations['p54'];//右耳上
                var plb = locations['p31'];//右鼻翼外側
                var plc = locations['p60'];//右下頰
                var pra = locations['p70'];//左耳上
                var prb = locations['p33'];//左鼻翼外側
                var prc = locations['p65'];//左下頰
                var loc = {};
                loc.blx = (pla.x + plb.x) / 2 - 10;
                loc.bly = (pla.y + plb.y) / 2 + 20;
                loc.blr = (plb.x - pla.x) / 2;
                draw_point('bl', {x:loc.blx, y:loc.bly}, 'bigp', 'BL');
                loc.brx = (pra.x + prb.x) / 2 + 10;
                loc.bry = (pra.y + prb.y) / 2 + 20;
                loc.brr = (prb.x - pra.x) / 2;
                draw_point('br', {x:loc.brx, y:loc.bry}, 'bigp', 'BR');
                var ple1 = locations['p12'];//右眼上前
                var ple2 = locations['p14'];//右眼上後
                var ple3 = locations['p77'];//右眼瞳孔
                var ple4 = locations['p71'];//右眉下中
                var pre1 = locations['p20'];//左眼上前
                var pre2 = locations['p22'];//左眼上後
                var pre3 = locations['p78'];//左眼瞳孔
                var pre4 = locations['p74'];//左眉下中
                loc.elx = (ple1.x + ple2.x) / 2 - 8;
                loc.ely = (ple3.y + ple4.y) / 2 + 5;
                loc.erx = (pre1.x + pre2.x) / 2 + 8;
                loc.ery = (pre3.y + pre4.y) / 2 + 5;
                return loc;
            }
            function fix_locations(p){
                var new_p = {};
                new_p.x = p.x -160;
                new_p.y = p.y;
                return new_p;
            }
            function get_text(furl, postdata, proc_handler){
                $.ajax({
                    method: "POST",
                    url: furl,
                    data: postdata,
                }).done(function( res ) {
                    if(typeof(proc_handler) === 'function') proc_handler(res);
                });
            }
            function msgbox_show(title, content){
                $('#alert-title').html(title);
                $('#alert-content').html(content);
                $('#alert-modal').modal('show');
            }
            function data_receiver(cmd){
                alert(cmd);
            }
        </script>
        <script>
        $(document).ready(function () {
            $("body").on("click", '.pag-funcs.list-btn', function (e) {
                var selected = $(this).hasClass('slide-active');
                $('#slidemenu').stop().animate({
                    left: selected ? '-80%' : '0px'
                });
                $('#navbar-height-col').stop().animate({
                    left: selected ? '-80%' : '0px'
                });
                $('.pag:visible').stop().animate({
                    left: selected ? '0px' : '80%'
                });
                $(this).toggleClass('slide-active', !selected);
                $('#slidemenu').toggleClass('slide-active');
                $('.pag:visible, .navbar, body, .navbar-header').toggleClass('slide-active');
            });
            $('#togglePoints').click(function(){
                var ht = $(this).html();
                if(ht == 'Show'){
                    $(this).html('Hide');
                    $('.sho-pic-container').show();
                }else{
                    $(this).html('Show');
                    $('.sho-pic-container').hide();
                }
                
            })
        });
        </script>
    </body>
</html>